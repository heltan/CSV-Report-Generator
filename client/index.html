<!DOCTYPE html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
    
    
  $('document').ready(function() {
    $('#submit').click(function() {
      //then submit ajax post request
     
     
      let file = document.getElementById('thefile').files[0];
      //because onload is an async func. we need to call other funcs
      let getData = (file, cb) => {
        let fr = new FileReader();
        fr.onload = function(event) {
          let contents = event.target.result;
          contents = JSON.parse(contents); 
          console.log('testing can we read this', contents);
          cb(contents);
        }
        //we need this readastext or we can't console log the contents
        fr.readAsText(file);
      };
      let postAjax = (data) => {
        console.log('data', data);
        $.ajax({
          type: 'POST',
          url: '/',
          dataType: 'json',
          data: data,
        });
      };
      //below will set the file contents into a 'data' object
      getData(file, function(e) {
        
       
        console.log('the data', e);
       
        //now we use this data object and call the ajax post request
        postAjax(e);
      });
      
     

     
    });
  });
  </script>
</head>
<body>

  <iframe name="myiframe" src= "http://localhost:3000/" ></iframe>


    <form enctype= "multipart/form-data" action= '' method='post' target="myiframe">

        <input name="text" type = 'file' id="thefile">
        <input type = 'submit' value = 'submit' id="submit">
    </form>
    <h1 id="current">Current CSV</h1>

    <script src="server.js"></script>
</body>